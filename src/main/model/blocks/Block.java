package model.blocks;

import com.sun.xml.internal.ws.policy.privateutil.PolicyUtils;
import model.patches.Patch;
import persistence.Reader;
import exceptions.BlockUnavailableException;

import java.io.File;
import java.io.IOException;
import java.util.ArrayList;
import java.util.List;

/*
Represents one square block of a quilt with a name, a finished size (in inches), and a list of patches
List of patches is automatically generated by from file based on the type of the block entered
*/

public class Block {

    private static final int NUM_OF_PATCHES = 9;

    private String blockType;
    private List<Patch> patches;

    // REQUIRES: finishedSize > 0
    // EFFECTS: creates a block (list of patches) of the given type
    //          if blockType is not a known type, constructor will throw a BlockUnavailableException
    public Block(String blockType) throws BlockUnavailableException {
        this.blockType = blockType;
        this.patches = BlockMap.getBlockPatchPattern(blockType);
    }

    // EFFECTS: Creates a block; used only when deserializing saved block data from JSON using GSON
    private Block() { }

    // getters
    public List<Patch> getPatches() {
        return patches;
    }

    public String getBlockType() {
        return blockType;
    }

    // EFFECTS: counts the number of patches of the given type needed to make the block
    public double countPatches(String patchType) {
        int count = 0;
        for (Patch p : patches) {
            if (p.getType().equals(patchType)) {
                count += 1;
            }
        }
        return count;
    }

    // REQUIRES: blockSize >= 0
    // EFFECTS: calculates amount of fabric (in square inches) needed of the given type to create block of given size
    public double calculateFabric(String fabric, double blockSize) {
        double total = 0;
        double patchSize = blockSize / Math.sqrt(NUM_OF_PATCHES);
        for (Patch p : patches) {
            if (p.containsFabric(fabric)) {
                total += p.calculateFabric(fabric, patchSize);
            }
        }
        return total;
    }

}

